worker_processes  1;

events {
    worker_connections  1024;
}

rtmp {
    server {
        listen 1935;
        chunk_size 4096;

        # OBSë¥˜ì—ì„œ RTMP ìŠ¤íŠ¸ë¦¼ì„ ìˆ˜ì‹ í•˜ì—¬ hlsìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ hlsì•±ì— ì „ì†¡í•œë‹¤.
        # - ğŸ¤” ë…¹í™”ëœ ê±¸ ë‹¤ì‹œ ë³´ë ¤ì£¼ë ¤ë©´ hlsí˜•ì‹ì„ ë‹¤ì‹œ ë§Œë“¤ì–´ì•¼ í•˜ë‚˜?
        application live {
            live on;  # ë¼ì´ë¸Œ ìŠ¤íŠ¸ë¦¬ë° í™œì„±í™”
            record off;  # ìŠ¤íŠ¸ë¦¼ ë…¹í™” ë¹„í™œì„±í™” -> ğŸ¤” ì• ì´ˆì— HLSë¥¼ ì ìš©í•˜ëŠ” ì‹œì ì—ì„œ recordí•˜ëŠ”ê±°ì•„ë‹ˆì•¼??
            # record all;                  # ëª¨ë“  ìŠ¤íŠ¸ë¦¼ì„ ê¸°ë¡
            # record_path /var/recording;  # ì €ì¥ ê²½ë¡œ ì„¤ì •
            # record_unique on;            # íŒŒì¼ëª…ì— íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€

            # OBSì—ì„œ ë³´ë‚¸ ìŠ¤íŠ¸ë¦¼ì„ ë‹¤ë¥¸ RTMP ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì „ë‹¬
            # push rtmp://localhost/hls;

            # FFmpegë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤íŠ¸ë¦¼ì„ HLSë¡œ ë³€í™˜
            # exec ffmpeg -i rtmp://localhost/live/$name -c:v libx264 -c:a aac -strict -2 -f flv rtmp://localhost/hls/$name;
            exec ffmpeg -i rtmp://localhost/live/$name
                -c:v libx264 -preset ultrafast -tune zerolatency -b:v 2500k -c:a aac -b:a 128k -f hls -hls_time 3 -hls_list_size 10 -hls_flags delete_segments /tmp/hls/$name.m3u8;
        }

        # FFmpegë¡œ ë³€í™˜ëœ ìŠ¤íŠ¸ë¦¼ì„ HLS í˜•ì‹ìœ¼ë¡œ ì œê³µí•œë‹¤.
        application hls {
            live on;  # ë¼ì´ë¸Œ ìŠ¤íŠ¸ë¦¬ë° í™œì„±í™”
            hls on;  # HLS (HTTP Live Streaming) í™œì„±í™”
            hls_path /tmp/hls;  # HLS íŒŒì¼(.m3u8, .ts)ì´ ì €ì¥ë  ê²½ë¡œ
            hls_fragment 3;  # ê° TS íŒŒì¼ì˜ ê¸¸ì´ (ì´ˆ ë‹¨ìœ„)
            hls_playlist_length 60;  # ì¬ìƒ ëª©ë¡(.m3u8)ì˜ ì „ì²´ ê¸¸ì´ (ì´ˆ ë‹¨ìœ„) # TSíŒŒì¼ì˜ ttlì´ê¸°ë„ í•¨.
        }
    }
}

http {
    server {
        listen 8080;  # HTTP ìš”ì²­ì„ 80ë²ˆ í¬íŠ¸ë¡œ ìˆ˜ì‹ 

        location /hls {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'Range';
            add_header 'Access-Control-Expose-Headers' 'Content-Length, Content-Range';

            if ($request_method = 'OPTIONS') {
                return 204;
            }

            types {
                application/vnd.apple.mpegurl m3u8;  # M3U8 íŒŒì¼ íƒ€ì… ì„¤ì •
                video/mp2t ts;  # TS íŒŒì¼ íƒ€ì… ì„¤ì •
            }
            root /tmp;  # HLS íŒŒì¼ì´ ì €ì¥ëœ ë£¨íŠ¸ ë””ë ‰í† ë¦¬
            add_header Cache-Control no-cache;  # ìºì‹œ ë¹„í™œì„±í™” (ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì— í•„ìš”)
        }
    }
}
